<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="_fragments :: head('Thêm Bộ truyện')"></head>
<body>
<div th:replace="_fragments :: header"></div>

<div class="container">
    <div class="breadcrumbs"><a th:href="@{/botruyen}">Bộ truyện</a> › <b>Thêm mới</b></div>

    <form th:action="@{/botruyen/add}" th:object="${boTruyen}" method="post" enctype="multipart/form-data" class="form">
        <div class="row" style="flex-direction:column;gap:12px">
            <div>
                <label>Tên truyện</label>
                <input type="text" th:field="*{tenTruyen}" required>
                <div class="err" th:if="${#fields.hasErrors('tenTruyen')}" th:errors="*{tenTruyen}"></div>
            </div>

            <div class="row">
                <div style="flex:1">
                    <label>Trạng thái</label>
                    <input type="text" th:field="*{trangThai}" placeholder="Đang Phát Hành">
                </div>
                <div style="flex:1">
                    <label>Thời gian phát hành</label>
                    <input type="date" th:field="*{thoiGianPhatHanh}">
                </div>
            </div>

            <div>
                <label>Mô tả ngắn</label>
                <textarea th:field="*{moTaNgan}" rows="2"></textarea>
            </div>
            <div>
                <label>Mô tả dài</label>
                <textarea th:field="*{moTaDai}" rows="4"></textarea>
            </div>

            <div>
                <label>Ảnh bìa</label>
                <input type="file" name="imageFile" accept="image/*">
                <div class="err" th:if="${#fields.hasErrors('image')}" th:errors="*{image}"></div>
            </div>

            <div>
                <div class="row" style="justify-content:space-between;align-items:center">
                    <label>Thuộc thể loại</label>
                    <div class="wrap">
                        <button type="button" class="btn" onclick="selectAllGenres(true)">Chọn tất cả</button>
                        <button type="button" class="btn" onclick="selectAllGenres(false)">Bỏ chọn</button>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(theLoais)}" class="muted">
                    Chưa có thể loại nào. <a class="btn" th:href="@{/theloai/add}" style="margin-left:6px">+ Thêm thể loại</a>
                </div>

                <!-- Multi-select -->
                <select id="genres" name="theLoaiIds" multiple size="6" class="select" style="width:100%;min-height:160px"
                        th:if="${!#lists.isEmpty(theLoais)}">
                    <option th:each="tl : ${theLoais}" th:value="${tl.theLoaiId}"
                            th:text="${tl.tenTheLoai}">TL</option>
                </select>

                <small class="muted">Giữ Ctrl/Cmd để chọn nhiều. Hoặc dùng “Chọn tất cả / Bỏ chọn”.</small>
            </div>

            <div class="row" style="gap:8px;margin-top:6px">
                <button type="submit" class="btn btn-primary">Lưu</button>
                <a class="btn" th:href="@{/botruyen}">Huỷ</a>
            </div>
        </div>
    </form>
</div>

<div th:replace="_fragments :: footer"></div>
<script>
    function selectAllGenres(flag){
        const sel = document.getElementById('genres');
        if(!sel) return;
        [...sel.options].forEach(o=>o.selected = !!flag);
    }
</script>
</body>
</html>
